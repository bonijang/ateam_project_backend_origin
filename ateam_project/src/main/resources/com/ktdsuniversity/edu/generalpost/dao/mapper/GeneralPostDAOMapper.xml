<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ktdsuniversity.edu.generalpost.dao.GeneralPostDAO">

	<select id="getBoardAllCount"
			resultType="_int">
		SELECT COUNT(1)
		  FROM GENERAL_POST
	</select>
	
	<update id="increaseViewCount"
			parameterType="_int">
		UPDATE GENERAL_POST
		   SET VIEW_CNT = VIEW_CNT + 1
		 WHERE GENERAL_POST_ID = #{_parameter}
	</update>
	
	<!-- 검색 -->
	<select id="searchAllBoard"
			parameterType="com.ktdsuniversity.edu.generalpost.vo.SearchForumVO"
			resultMap="generalPostVO">
		SELECT GP.GENERAL_POST_ID
			 , GP.POST_WRITER
			 , GP.BOARD_ID
			 , GP.POST_TITLE
			 , GP.POST_CONTENT
			 , TO_CHAR(GP.POST_DATE, 'YYYY-MM-DD') POST_DATE
			 , GP.LIKE_CNT
			 , GP.VIEW_CNT
			 , GP.DELETE_YN
			 , M.NICKNAME
		  FROM GENERAL_POST GP
		 INNER JOIN MEMBER M
		    ON M.EMAIL = GP.POST_WRITER
		 ORDER BY GP.GENERAL_POST_ID DESC
		 
	</select>
	
	<resultMap type="com.ktdsuniversity.edu.generalpost.vo.GeneralPostVO" 
	           id="generalPostVO">
	    <!-- PK 컬럼을 대상으로 작성. -->
	    <id column="GENERALPOSTID" property="generalp]Posti]Id" />
	    <!-- 일반 컬럼을 대상으로 작성. -->
	    <result column="POSTWRITER" property="psotWriter" />
	    <result column="BOARDID" property="boardId" />
	    <result column="POSTTITLE" property="postTitle" />
	    <result column="POSTCONTENT" property="postContent" />
	    <result column="POSTDATE" property="postDate" />
	    <result column="LIKECNT" property="likeCnt" />
	    <result column="VIEWCNT" property="viewCnt" />
	    <result column="DELETEYN" property="deleteYn" />
	    <!-- 1:1 Has a 관계에서 사용한다. -->
	    <association property="memberVO" 
	                 javaType="com.ktdsuniversity.edu.member.vo.MemberVO">
	        <id column="EMAIL" property="email" />
	        <result column="NICKNAME" property="nickname" />
	    </association>
	</resultMap>
	

	<!-- 자유게시판 -->
	<insert id="createNewFreeBoard"
			parameterType="com.ktdsuniversity.edu.generalpost.vo.GeneralPostVO">
		INSERT INTO GENERAL_POST 
			(GENERAL_POST_ID
			, POST_WRITER
			, BOARD_ID
			, POST_TITLE
			, POST_CONTENT
			, POST_DATE
			, LIKE_CNT
			, VIEW_CNT
			, DELETE_YN) 
		VALUES 
		 (SEQ_GENERAL_POST_PK.NEXTVAL
	        , #{postWriter}
			, 'CC-20231017-000029' 
			, #{postTitle}
			, #{postContent}
			, SYSDATE
			, #{likeCnt}
			, #{viewCnt}
			, 'N' )
	</insert>
	
	<select id="getOneFreeBoard"
		parameterType="string"
		resultType="com.ktdsuniversity.edu.generalpost.vo.GeneralPostVO">
		SELECT GENERAL_POST_ID
		     , POST_WRITER
		     , BOARD_ID
		     , POST_TITLE
		     , POST_CONTENT
		     , POST_DATE
		     , LIKE_CNT
		     , VIEW_CNT
		     , DELETE_YN
		  FROM GENERAL_POST
		 WHERE GENERAL_POST_ID = #{_parameter}
	</select>
	
	<select id="getAllFreeBoard"
	resultType="com.ktdsuniversity.edu.generalpost.vo.GeneralPostVO">
		SELECT GENERAL_POST_ID
		     , POST_WRITER
		     , BOARD_ID
		     , POST_TITLE
		     , POST_CONTENT
		     , POST_DATE
		     , LIKE_CNT
		     , VIEW_CNT
		     , DELETE_YN
		  FROM GENERAL_POST
		 WHERE DELETE_YN = 'N'
		   AND BOARD_ID = 'CC-20231017-000029'
		 ORDER BY POST_DATE DESC
	</select>

	
	<update id="updateOneFreeBoard"
		parameterType="com.ktdsuniversity.edu.generalpost.vo.GeneralPostVO">
		UPDATE GENERAL_POST
		   SET POST_TITLE = #{postTitle}
		     , POST_CONTENT = #{postContent}
		     , POST_DATE = SYSDATE
		 WHERE GENERAL_POST_ID = #{generalPostId}
	</update>

    <update id="deleteOneFreeBoard"
	parameterType="com.ktdsuniversity.edu.generalpost.vo.GeneralPostVO">
		UPDATE GENERAL_POST
		   SET DELETE_YN = 'Y'
		 WHERE GENERAL_POST_ID = #{generalPostId}
	</update>
	
	<!-- 질답게시판 -->
	<select id="getAllQnABoard"
	resultMap="generalPostVO"
	parameterType="string">
		SELECT GP.GENERAL_POST_ID
		     , GP.POST_WRITER
		     , GP.BOARD_ID
		     , GP.POST_TITLE
		     , GP.POST_CONTENT
		     , TO_CHAR(GP.POST_DATE, 'YYYY-MM-DD') POST_DATE
		     , GP.LIKE_CNT
		     , GP.VIEW_CNT
		     , GP.DELETE_YN
		  FROM GENERAL_POST GP
		 INNER JOIN MEMBER M
		    ON M.EMAIL = GP.POST_WRITER
		 INNER JOIN COMMON_CODE CC
		    ON CC.CODE_ID = GP.BOARD_ID
		   AND BOARD_ID = #{_parameter} 
		 ORDER BY POST_DATE DESC 
	</select>
	
	<insert id="createNewQnABoard"
			parameterType="com.ktdsuniversity.edu.generalpost.vo.GeneralPostVO">
		INSERT INTO GENERAL_POST 
		 (GENERAL_POST_ID
			 , POST_WRITER
			 , BOARD_ID
			 , POST_TITLE
			 , POST_CONTENT
			 , POST_DATE
			 , LIKE_CNT
			 , VIEW_CNT
		 	 , DELETE_YN) 
		VALUES 
		 (SEQ_GENERAL_POST_PK.NEXTVAL
	         , #{postWriter}
			 , 'CC-20231017-000030' 
			 , #{postTitle}
			 , #{postContent}
			 , SYSDATE
			 , 0
			 , 0
			 , 'N' )
	</insert>
	
	<select id="getOneQnABoard"
		parameterType="string"
		resultType="com.ktdsuniversity.edu.generalpost.vo.GeneralPostVO">
		SELECT GENERAL_POST_ID
		     , POST_WRITER
		     , BOARD_ID
		     , POST_TITLE
		     , POST_CONTENT
		     , POST_DATE
		     , LIKE_CNT
		     , VIEW_CNT
		     , DELETE_YN
		  FROM GENERAL_POST
		 WHERE GENERAL_POST_ID = #{_parameter}		 
	</select>
	
	<update id="updateOneQnABoard"
		parameterType="com.ktdsuniversity.edu.generalpost.vo.GeneralPostVO">
		UPDATE GENERAL_POST
		   SET POST_TITLE = #{postTitle}
		     , POST_CONTENT = #{postContent}
		     , POST_DATE = SYSDATE
		 WHERE GENERAL_POST_ID = #{generalPostId}
	</update>

    <update id="deleteOneQnABoard"
	parameterType="com.ktdsuniversity.edu.generalpost.vo.GeneralPostVO">
		UPDATE GENERAL_POST
		   SET DELETE_YN = 'Y'
		 WHERE GENERAL_POST_ID = #{generalPostId}
	</update>
</mapper>